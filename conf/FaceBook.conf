upstream FBCDN {
    server [2a03:2880:f05e:10c:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05e:10:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f01d:a:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f01d:10c:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f04e:f:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f0a2:16:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f00c:10d:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f00c:300:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05c:10:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05c:110:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05c:20d:face:b00c:0:3]:443 max_fails=10 fail_timeout=60s;
    keepalive 16;
    keepalive_time 1h;
    keepalive_timeout 300s;
    keepalive_requests 10000;
}

upstream FB-gateway {
    server [2a03:2880:f05c:1:face:b00c:0:6206]:443;
    server [2a03:2880:f05c:100:face:b00c:0:6206]:443;
    server [2a03:2880:f05c:208:face:b00c:0:6206]:443;
    server [2a03:2880:f05e:0:face:b00c:0:6206]:443;
    server [2a03:2880:f05e:115:face:b00c:0:6206]:443;
    server [2a03:2880:f0a2:13:face:b00c:0:6206]:443;
    server [2a03:2880:f00c:11:face:b00c:0:6206]:443;
    server [2a03:2880:f00c:108:face:b00c:0:6206]:443;
    server [2a03:2880:f00c:20c:face:b00c:0:6206]:443;
    server [2a03:2880:f00c:314:face:b00c:0:6206]:443;
    server [2a03:2880:f01d:d:face:b00c:0:6206]:443;
    server [2a03:2880:f01d:105:face:b00c:0:6206]:443;
    server [2a03:2880:f04e:1:face:b00c:0:6206]:443;
    keepalive 16;
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name gateway.facebook.com;

    access_log logs/FaceBook-access.log main buffer=4k;
    #access_log off;
    error_log logs/FaceBook-error.log;

    include cert.conf;
    location / {
        proxy_pass https://FB-gateway/;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        include Proxy.params;
    }
}

upstream FB {
    server [2a03:2880:f186:84:face:b00c:0:25de]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f15e:83:face:b00c:0:25de]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f15e:182:face:b00c:0:25de]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f115:83:face:b00c:0:25de]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f115:188:face:b00c:0:25de]:443 max_fails=10 fail_timeout=60s;
    keepalive 16;
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name www.facebook.com;
    server_name facebook.com;

    access_log logs/FaceBook-access.log main buffer=4k;
    #access_log off;
    error_log logs/FaceBook-error.log;

    include cert.conf;
    location / {
        proxy_pass https://FB/;
        proxy_next_upstream error timeout http_429 http_500 http_502 http_503 http_504 non_idempotent;
        proxy_buffer_size 128k;
        proxy_buffers 16 32k;
        proxy_busy_buffers_size 128k;
        include Proxy.conf;
    }
}

upstream FB-S {
    server [2a03:2880:f01d:6:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f01d:106:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f0a2:1:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05c:12:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05c:112:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05c:204:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05e:12:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f05e:100:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f00c:100:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    server [2a03:2880:f00c:310:face:b00c:0:2]:443 max_fails=10 fail_timeout=60s;
    keepalive 16;
}
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name *.facebook.com;

    access_log logs/FaceBook-access.log main buffer=4k;
    #access_log off;
    error_log logs/FaceBook-error.log;

    include cert.conf;
    location / {
        proxy_pass https://FB-S/;
        proxy_buffer_size 128k;
        proxy_buffers 16 32k;
        proxy_busy_buffers_size 128k;
        include Proxy.conf;
    }
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name facebook.net;
    server_name *.facebook.net;
    server_name fbsbx.com;
    server_name *.fbsbx.com;
    server_name fbcdn.net;
    server_name *.fbcdn.net;

    access_log logs/FaceBook-access.log main buffer=4k;
    #access_log off;
    error_log logs/FaceBook-error.log;

    include cert.conf;
    location / {
        proxy_pass https://FBCDN/;
        proxy_next_upstream error timeout http_429 http_500 http_502 http_503 http_504 non_idempotent;
        proxy_buffer_size 128k;
        proxy_buffers 16 32k;
        proxy_busy_buffers_size 128k;
        include Proxy.conf;
    }
}