#   dlsite Start

upstream download-dlsite-com {
    server 61.110.197.198:443;#韩国首尔KT转cdnetworks
    server [2401:8700:ff03:1::50]:443;#日本cdnetworks—IPV6节点，速度快
    server 202.75.191.42:443;#马来西亚，移动速度快
    server 138.113.77.50:443;#日本大阪quantilnetworks.com
    server 138.113.67.200:443;#越南胡志明市
    server 61.110.197.198:443;#韩国首尔KT转cdnetworks
    server 14.0.119.186:443;#韩国首尔KT转cdnetworks
    server 14.0.37.7:443;#俄罗斯莫斯科
    server 14.0.39.123:443;#香港pccw转cdnetworks
    server 14.0.62.215:443;#菲律宾马尼拉pccw转cdnetworks
    server 14.0.32.69:443;
    server 14.0.32.71:443;
    server 14.0.113.92:443;
    server 14.0.119.186:443;
    server 210.65.162.163:443;
    server 202.191.99.176:443;
    server 210.65.162.163:443;
    server 163.171.83.101:443;#日本东京cdnetworks
    server 163.171.82.142:443;#泰国曼谷cdnetworks
    server 163.171.115.231:443;#马来西亚赛城cdnetworks
    server 163.171.147.207:443;#奥地利维也纳cdnetworks
    server 163.171.228.48:443;#美国弗吉尼亚阿什本cdnetworks
    server 163.171.236.105:443;#加拿大多伦多cdnetworks
    server 163.171.227.237:443;
    server 163.171.229.207:443;
    server 163.171.239.65:443;
    server [2606:1980:104:ffff:ff99:ae37:cbe0:5fb4]:443;
    server [2a01:53c0:ffbf:1:e1bd:657f:ccbc:6a80]:443;
    server [2a01:53c0:ffe5:ffff:66:aca2:a53e:d935]:443;
    server [2a01:53c0:fff8:ffff:a594:161b:a7b2:d55b]:443;
#    server eisysinc.qtlcdn.com:443;#备选方案，是通用域名解析，易被污染
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name www.dlsite.com;
    server_name media.dlsite.com;
    server_name download.dlsite.com;
    server_name login.dlsite.com;
    server_name ssl.dlsite.com;
    server_name img.dlsite.jp;
    server_name media.ci-en.jp;

    include cert.conf;

    location / {
        resolver public1.alidns.com:53 valid=5 ipv4=on ipv6=on;
        set $dlsite eisysinc.qtlcdn.com;
        proxy_max_temp_file_size 0;
        #proxy_pass https://download-dlsite-com/;
        proxy_pass https://$dlsite/$request_uri;
        proxy_http_version 1.1;
        proxy_next_upstream_timeout 60;
        proxy_connect_timeout 3;
        proxy_send_timeout 3;
        proxy_read_timeout 3;
        proxy_set_header Host $http_host;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Range $http_range;
        proxy_set_header If-Range $http_if_range;
        proxy_set_header Accept-Encoding '';
        proxy_buffering off;
        proxy_ssl_server_name on;
        proxy_ssl_name $http_host;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name play.dlsite.com;

    include cert.conf;

    location / {
        resolver public1.alidns.com:53 valid=300;
        set $play_dl_c15412_gq play.dl.c15412.gq;
        proxy_pass https://$play_dl_c15412_gq:443/$request_uri;
        proxy_http_version 1.1;
        proxy_set_header Host $http_host;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding '';
        proxy_buffering off;
        proxy_ssl_server_name on;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name ch.dlsite.com;

    include cert.conf;

    location / {
        resolver public1.alidns.com:53 valid=300;
        set $ch_dl_c15412_gq ch.dl.c15412.gq;
        proxy_pass https://$ch_dl_c15412_gq:443/$request_uri;
        proxy_http_version 1.1;
        proxy_set_header Host $http_host;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding '';
        proxy_buffering off;
        proxy_ssl_server_name on;
    }
}

server {
    listen 443 ssl;
    listen [::]:443 ssl;
    server_name ci-en.dlsite.com;
    server_name ci-en.net;

    include cert.conf;

    location / {
        resolver public1.alidns.com:53 valid=300;
        set $cien_net ci-en.net;
        proxy_pass https://$cien_net:443/$request_uri;
        proxy_http_version 1.1;
        proxy_set_header Host $http_host;
        proxy_set_header User-Agent $http_user_agent;
        proxy_set_header Accept-Encoding '';
        proxy_buffering off;
        proxy_ssl_server_name on;
        proxy_ssl_name $http_host;
    }
}
#   dlsite End